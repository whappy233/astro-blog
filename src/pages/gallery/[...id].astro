---
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { getAllGalleries } from '@/lib/data-utils'
import { Image, getImage } from 'astro:assets'
import type { ImageMetadata } from "astro";

export async function getStaticPaths() {
  const galleries = await getAllGalleries()
  return galleries.map((gallery) => ({
    params: { id: gallery.id },
    props: { gallery },
  }))
}

const { gallery } = Astro.props

const images = import.meta.glob<{ default: ImageMetadata }>("/src/content/gallery/assets/gallery-1/*.png");
const imagePaths = Object.keys(images).filter(imagePath => imagePath.startsWith("/src/content/"));
const imgs = Object.values(import.meta.glob('/src/content/gallery/assets/gallery-1/*.png', { eager: true }));
---

<Layout class="max-w-3xl">
  <PageHead
    slot="head"
    title={`${gallery.data.name} (Gallery)`}
    description={`${gallery.data.name} (Gallery)`}
    noindex
  />
  <Breadcrumbs
    items={[
      { href: '/gallery', label: 'Photos', icon: 'lucide:aperture' },
      { label: gallery.data.name, icon: 'lucide:images' },
    ]}
  />
  {gallery.data.name}

  <div id="main">
    {
      imagePaths.map(async (imagePath) => {
        const image = images[imagePath]()
        const optimizedImage = await getImage({
          src: image,
          width: 100,
        })

        return (
          <article class="thumb">
            <a class="image" href={optimizedImage.src}>
              <Image src={image} height="100" alt="Astro Multiverse" />
            </a>
          </article>
        )
      })
    }
  </div>

  <ul>
    {
      imgs.map(img => (
        <li>
          <img src={img.default.src} alt='ccc' class="object-cover"/>
        </li>
      ))
    }
  </ul>

</Layout>
